In total 1 of 3 tests failed.


---
Outcome of test 'source_r': ok
All R files could be sourced.



---
Outcome of test 'do1': ok


Details:

cmd_df = do_parse(do_code)
cmd_df = mark_data_manip_cmd(cmd_df)

str(cmd_df)
'data.frame':	38 obs. of  9 variables:
 $ line              : int  1 2 3 4 5 6 7 8 9 10 ...
 $ do_code           : chr  "use \"data.dta\", clear" "sort group i" "keep in 1/39" "list in 1/5" ...
 $ stata_cmd_original: chr  "use" "sort" "keep" "list" ...
 $ stata_cmd         : chr  "use" "sort" "keep" "list" ...
 $ rest_of_cmd       : chr  "\"data.dta\", clear" "group i" "in 1/39" "in 1/5" ...
 $ is_by_prefix      : logi  FALSE FALSE FALSE FALSE FALSE TRUE ...
 $ by_group_vars     : chr  NA NA NA NA ...
 $ by_sort_vars      : chr  NA NA NA NA ...
 $ do_translate      : logi  TRUE TRUE TRUE FALSE FALSE TRUE ...
NULL

---
#Translate Stata to R commands... ... translation done.
---
# Run translated R commands and compare results


 1 do:  use "data.dta", clear
 1 r:  data = haven::read_dta(file.path(stata2r_env$working_dir, "data.dta")) # 'clear' was used 
data = haven::read_dta(file.path(stata2r_env$working_dir, "data.dta")) # 'clear' was used

 2 do:  sort group i
 2 r:  data = dplyr::arrange(data, group, i) 
data = dplyr::arrange(data, group, i)

 3 do:  keep in 1/39
 3 r:  data = dplyr::slice(data, 1:39) 
data = dplyr::slice(data, 1:39)

 4 do:  list in 1/5 

 4 r:  not translated since not flagged as data manipulation

 5 do:  display _n 

 5 r:  not translated since not flagged as data manipulation

 6 do:  by group: gen seq = _n
 6 r:  data = data %>%
  dplyr::group_by(dplyr::across(c("group"))) %>%
  dplyr::mutate(seq = as.numeric(dplyr::row_number())) %>%
  dplyr::ungroup()
data$seq = sfun_strip_stata_attributes(data$seq) 
data = data %>%
  dplyr::group_by(dplyr::across(c("group"))) %>%
  dplyr::mutate(seq = as.numeric(dplyr::row_number())) %>%
  dplyr::ungroup()

data$seq = sfun_strip_stata_attributes(data$seq)

 7 do:  gen logi = log(i)
 7 r:  data = data %>%
  dplyr::mutate(logi = log(i))
data$logi = sfun_strip_stata_attributes(data$logi) 
data = data %>%
  dplyr::mutate(logi = log(i))

data$logi = sfun_strip_stata_attributes(data$logi)

 8 do:  gen sqrt_i = sqrt(i)
 8 r:  data = data %>%
  dplyr::mutate(sqrt_i = sqrt(i))
data$sqrt_i = sfun_strip_stata_attributes(data$sqrt_i) 
data = data %>%
  dplyr::mutate(sqrt_i = sqrt(i))

data$sqrt_i = sfun_strip_stata_attributes(data$sqrt_i)

 9 do:  gen group_num = cond(group=="A",1,cond(group=="B",2,3))
 9 r:  data = data %>%
  dplyr::mutate(group_num = as.numeric(dplyr::if_else(group=="A", 1, dplyr::if_else(group=="B", 2, 3))))
data$group_num = sfun_strip_stata_attributes(data$group_num) 
data = data %>%
  dplyr::mutate(group_num = as.numeric(dplyr::if_else(group=="A", 1, dplyr::if_else(group=="B", 2, 3))))

data$group_num = sfun_strip_stata_attributes(data$group_num)

 10 do:  egen mean_i_grp = mean(i), by(group)
 10 r:  data = data %>%
  dplyr::group_by(dplyr::across(
c("group")
)) %>%
  dplyr::mutate(
mean_i_grp = mean(i, na.rm = TRUE)
) %>%
  dplyr::ungroup()
data$mean_i_grp = sfun_strip_stata_attributes(data$mean_i_grp) 
data = data %>%
  dplyr::group_by(dplyr::across(
c("group")
)) %>%
  dplyr::mutate(
mean_i_grp = mean(i, na.rm = TRUE)
) %>%
  dplyr::ungroup()

data$mean_i_grp = sfun_strip_stata_attributes(data$mean_i_grp)

 11 do:  egen total_i = total(i)
 11 r:  data = data %>%
  dplyr::mutate(
total_i = sum(i, na.rm = TRUE)
)
data$total_i = sfun_strip_stata_attributes(data$total_i) 
data = data %>%
  dplyr::mutate(
total_i = sum(i, na.rm = TRUE)
)

data$total_i = sfun_strip_stata_attributes(data$total_i)

 12 do:  bysort group: egen rank_i = rank(i)
 12 r:  data = data %>%
  dplyr::group_by(dplyr::across(
c("group")
)) %>%
  dplyr::mutate(
rank_i = dplyr::min_rank(i)
) %>%
  dplyr::ungroup()
data$rank_i = sfun_strip_stata_attributes(data$rank_i) 
data = data %>%
  dplyr::group_by(dplyr::across(
c("group")
)) %>%
  dplyr::mutate(
rank_i = dplyr::min_rank(i)
) %>%
  dplyr::ungroup()

data$rank_i = sfun_strip_stata_attributes(data$rank_i)

 13 do:  gen flag = (i>20) if group=="A"
 13 r:  data = data %>%
  dplyr::mutate(flag = dplyr::if_else(group=="A", as.numeric((i>20)), NA_real_))
data$flag = sfun_strip_stata_attributes(data$flag) 
data = data %>%
  dplyr::mutate(flag = dplyr::if_else(group=="A", as.numeric((i>20)), NA_real_))

data$flag = sfun_strip_stata_attributes(data$flag)

 14 do:  replace flag = 0 if missing(flag)
 14 r:  data = data %>%
  dplyr::mutate(flag = dplyr::if_else(is.na(flag), 0, data$flag))
data$flag = sfun_strip_stata_attributes(data$flag) 
data = data %>%
  dplyr::mutate(flag = dplyr::if_else(is.na(flag), 0, data$flag))

data$flag = sfun_strip_stata_attributes(data$flag)

 15 do:  keep if flag==1 | group=="B"
 15 r:  data = dplyr::filter(data, flag==1 | group=="B") 
data = dplyr::filter(data, flag==1 | group=="B")

 16 do:  drop if i>35
 16 r:  data = dplyr::filter(data, !(i>35)) 
data = dplyr::filter(data, !(i>35))

 17 do:  collapse (mean) i (sum) total_i_sum = i, by(group)
 17 r:  data = data %>% 
  collapse::fgroup_by(group) %>% 
  collapse::fsummarise(`i` = collapse::fmean(i, na.rm = TRUE),
  `total_i_sum` = collapse::fsum(i, na.rm = TRUE)) %>% 
  collapse::fungroup()
data$`i` = sfun_strip_stata_attributes(data$`i`)
data$`total_i_sum` = sfun_strip_stata_attributes(data$`total_i_sum`) 
data = data %>% 
  collapse::fgroup_by(group) %>% 
  collapse::fsummarise(`i` = collapse::fmean(i, na.rm = TRUE),
  `total_i_sum` = collapse::fsum(i, na.rm = TRUE)) %>% 
  collapse::fungroup()

data$`i` = sfun_strip_stata_attributes(data$`i`)

data$`total_i_sum` = sfun_strip_stata_attributes(data$`total_i_sum`)

 18 do:  rename i mean_i_overall
 18 r:  data = collapse::frename(data, `i` = `mean_i_overall`) 
data = collapse::frename(data, `i` = `mean_i_overall`)

 19 do:  expand 2 if group=="C"
 19 r:  stata_tmp_expand_n_values_L19 = 2
stata_tmp_expand_cond_values_L19 = with(data, group=="C")
stata_tmp_final_expand_times_L19 = ifelse(!is.na(stata_tmp_expand_cond_values_L19) & stata_tmp_expand_cond_values_L19, ifelse(is.na(stata_tmp_expand_n_values_L19), 1, pmax(0, as.integer(stata_tmp_expand_n_values_L19))), 1)
stata_tmp_final_expand_times_L19 = ifelse(is.na(stata_tmp_final_expand_times_L19), 1, stata_tmp_final_expand_times_L19)
data = data[base::rep(1:NROW(data), times = stata_tmp_final_expand_times_L19), ]
if (exists('stata_tmp_expand_n_values_L19')) rm(stata_tmp_expand_n_values_L19, stata_tmp_expand_cond_values_L19, stata_tmp_final_expand_times_L19) 
stata_tmp_expand_n_values_L19 = 2

stata_tmp_expand_cond_values_L19 = with(data, group=="C")

stata_tmp_final_expand_times_L19 = ifelse(!is.na(stata_tmp_expand_cond_values_L19) & stata_tmp_expand_cond_values_L19, ifelse(is.na(stata_tmp_expand_n_values_L19), 1, pmax(0, as.integer(stata_tmp_expand_n_values_L19))), 1)

stata_tmp_final_expand_times_L19 = ifelse(is.na(stata_tmp_final_expand_times_L19), 1, stata_tmp_final_expand_times_L19)

data = data[base::rep(1:NROW(data), times = stata_tmp_final_expand_times_L19), ]

if (exists('stata_tmp_expand_n_values_L19')) rm(stata_tmp_expand_n_values_L19, stata_tmp_expand_cond_values_L19, stata_tmp_final_expand_times_L19)

 20 do:  duplicates drop
 20 r:  ## Calculate duplicate flag based on all variables
stata_tmp_is_duplicate_L20 = base::duplicated(data, fromLast = FALSE)
## Calculate condition flag
stata_tmp_satisfies_cond_L20 = TRUE
data = dplyr::filter(data, !(stata_tmp_is_duplicate_L20 & stata_tmp_satisfies_cond_L20))
rm(stata_tmp_is_duplicate_L20, stata_tmp_satisfies_cond_L20) 
## Calculate duplicate flag based on all variables

stata_tmp_is_duplicate_L20 = base::duplicated(data, fromLast = FALSE)

## Calculate condition flag

stata_tmp_satisfies_cond_L20 = TRUE

data = dplyr::filter(data, !(stata_tmp_is_duplicate_L20 & stata_tmp_satisfies_cond_L20))

rm(stata_tmp_is_duplicate_L20, stata_tmp_satisfies_cond_L20)

 21 do:  encode group, gen(group_code)
 21 r:  data = dplyr::mutate(data, group_code = haven::labelled(rep(NA_integer_, NROW(data)), labels = c()))
temp_source_vector_L21 = data[['group']]
temp_unique_labels_L21 = base::sort(base::unique(stats::na.omit(temp_source_vector_L21[temp_source_vector_L21 != ""])))
temp_numeric_values_L21 = base::match(temp_source_vector_L21, temp_unique_labels_L21)
temp_label_map_L21 = if (length(temp_unique_labels_L21) > 0) stats::setNames(seq_along(temp_unique_labels_L21), temp_unique_labels_L21) else stats::setNames(integer(0), character(0))
stata_tmp_encoded_full_L21 = haven::labelled(as.integer(temp_numeric_values_L21), labels = temp_label_map_L21)
rm(temp_source_vector_L21, temp_unique_labels_L21, temp_numeric_values_L21, temp_label_map_L21)
data[['group_code']] = stata_tmp_encoded_full_L21
rm(stata_tmp_encoded_full_L21)
data$group_code = sfun_strip_stata_attributes(data$group_code) 
data = dplyr::mutate(data, group_code = haven::labelled(rep(NA_integer_, NROW(data)), labels = c()))

temp_source_vector_L21 = data[['group']]

temp_unique_labels_L21 = base::sort(base::unique(stats::na.omit(temp_source_vector_L21[temp_source_vector_L21 != ""])))

temp_numeric_values_L21 = base::match(temp_source_vector_L21, temp_unique_labels_L21)

temp_label_map_L21 = if (length(temp_unique_labels_L21) > 0) stats::setNames(seq_along(temp_unique_labels_L21), temp_unique_labels_L21) else stats::setNames(integer(0), character(0))

stata_tmp_encoded_full_L21 = haven::labelled(as.integer(temp_numeric_values_L21), labels = temp_label_map_L21)

rm(temp_source_vector_L21, temp_unique_labels_L21, temp_numeric_values_L21, temp_label_map_L21)

data[['group_code']] = stata_tmp_encoded_full_L21

rm(stata_tmp_encoded_full_L21)

data$group_code = sfun_strip_stata_attributes(data$group_code)

 22 do:  decode group_code, gen(group_str)
 22 r:  data = dplyr::mutate(data, group_str = NA_character_)
## Decode values using haven::as_factor
stata_tmp_decoded_values_L22 = with(data, as.character(haven::as_factor(group_code, levels = 'labels')))
data = dplyr::mutate(data, group_str = stata_tmp_decoded_values_L22)
rm(stata_tmp_decoded_values_L22)
data$group_str = sfun_strip_stata_attributes(data$group_str) 
data = dplyr::mutate(data, group_str = NA_character_)

## Decode values using haven::as_factor

stata_tmp_decoded_values_L22 = with(data, as.character(haven::as_factor(group_code, levels = 'labels')))

data = dplyr::mutate(data, group_str = stata_tmp_decoded_values_L22)

rm(stata_tmp_decoded_values_L22)

data$group_str = sfun_strip_stata_attributes(data$group_str)

 23 do:  sort group_code
 23 r:  data = dplyr::arrange(data, group_code) 
data = dplyr::arrange(data, group_code)

 24 do:  tempfile t1
 24 r:  R_tempfile_L24_t1_path = tempfile(fileext = '.dta') # Stata tempfile 't1' 
R_tempfile_L24_t1_path = tempfile(fileext = '.dta') # Stata tempfile 't1'

 25 do:  save "`t1'"
 25 r:  haven::write_dta(data, path = R_tempfile_L24_t1_path) 
haven::write_dta(data, path = R_tempfile_L24_t1_path)

 26 do:  keep if group_code==1
 26 r:  data = dplyr::filter(data, group_code==1) 
data = dplyr::filter(data, group_code==1)

 27 do:  merge 1:m group_code using "`t1'", keep(match master) nogenerate
 27 r:  stata_tmp_using_data_L27 = haven::read_dta(R_tempfile_L24_t1_path)
common_cols = intersect(names(data), names(stata_tmp_using_data_L27))
common_cols_not_by = setdiff(common_cols, c("group_code"))
if (length(common_cols_not_by) > 0) { stata_tmp_using_data_L27 = dplyr::select(stata_tmp_using_data_L27, -dplyr::all_of(common_cols_not_by)) }
data = dplyr::left_join(data, stata_tmp_using_data_L27, by = c("group_code")) # Stata merge type: 1:m, keep(master), nogenerate
rm(stata_tmp_using_data_L27, common_cols, common_cols_not_by) 
stata_tmp_using_data_L27 = haven::read_dta(R_tempfile_L24_t1_path)

common_cols = intersect(names(data), names(stata_tmp_using_data_L27))

common_cols_not_by = setdiff(common_cols, c("group_code"))

if (length(common_cols_not_by) > 0) { stata_tmp_using_data_L27 = dplyr::select(stata_tmp_using_data_L27, -dplyr::all_of(common_cols_not_by)) }

data = dplyr::left_join(data, stata_tmp_using_data_L27, by = c("group_code")) # Stata merge type: 1:m, keep(master), nogenerate

rm(stata_tmp_using_data_L27, common_cols, common_cols_not_by)

 28 do:  append using "`t1'"
 28 r:  data = dplyr::bind_rows(data, haven::read_dta(R_tempfile_L24_t1_path)) 
data = dplyr::bind_rows(data, haven::read_dta(R_tempfile_L24_t1_path))

 29 do:  gen id = _n
 29 r:  data = data %>%
  dplyr::mutate(id = as.numeric(dplyr::row_number()))
data$id = sfun_strip_stata_attributes(data$id) 
data = data %>%
  dplyr::mutate(id = as.numeric(dplyr::row_number()))

data$id = sfun_strip_stata_attributes(data$id)

 30 do:  bysort group_code (mean_i_overall): gen diff_mean = mean_i_overall - mean_i_overall[_n-1]
 30 r:  data = dplyr::arrange(data, group_code, mean_i_overall) %>%
  dplyr::group_by(dplyr::across(c("group_code"))) %>%
  dplyr::mutate(diff_mean = mean_i_overall - dplyr::lag(mean_i_overall, n = 1)) %>%
  dplyr::ungroup()
data$diff_mean = sfun_strip_stata_attributes(data$diff_mean) 
data = dplyr::arrange(data, group_code, mean_i_overall) %>%
  dplyr::group_by(dplyr::across(c("group_code"))) %>%
  dplyr::mutate(diff_mean = mean_i_overall - dplyr::lag(mean_i_overall, n = 1)) %>%
  dplyr::ungroup()

data$diff_mean = sfun_strip_stata_attributes(data$diff_mean)

 31 do:  recode group_code (1=10)(2=20)(3=30)
 31 r:  data = dplyr::mutate(data, group_code = dplyr::case_when(
    data$group_code %in% c(1) ~ 10,
    data$group_code %in% c(2) ~ 20,
    data$group_code %in% c(3) ~ 30
  ))
data$group_code = sfun_strip_stata_attributes(data$group_code) 
data = dplyr::mutate(data, group_code = dplyr::case_when(
    data$group_code %in% c(1) ~ 10,
    data$group_code %in% c(2) ~ 20,
    data$group_code %in% c(3) ~ 30
  ))

data$group_code = sfun_strip_stata_attributes(data$group_code)

 32 do:  drop if missing(mean_i_overall)
 32 r:  data = dplyr::filter(data, !(is.na(mean_i_overall))) 
data = dplyr::filter(data, !(is.na(mean_i_overall)))

 33 do:  order id group_code mean_i_overall
 33 r:  data = dplyr::select(data, id, group_code, mean_i_overall, dplyr::everything()) 
data = dplyr::select(data, id, group_code, mean_i_overall, dplyr::everything())

 34 do:  collapse (sum) sum_mean = mean_i_overall, by(group_code)
 34 r:  data = data %>% 
  collapse::fgroup_by(group_code) %>% 
  collapse::fsummarise(`sum_mean` = collapse::fsum(mean_i_overall, na.rm = TRUE)) %>% 
  collapse::fungroup()
data$`sum_mean` = sfun_strip_stata_attributes(data$`sum_mean`) 
data = data %>% 
  collapse::fgroup_by(group_code) %>% 
  collapse::fsummarise(`sum_mean` = collapse::fsum(mean_i_overall, na.rm = TRUE)) %>% 
  collapse::fungroup()

data$`sum_mean` = sfun_strip_stata_attributes(data$`sum_mean`)

 35 do:  egen total_sum = total(sum_mean)
 35 r:  data = data %>%
  dplyr::mutate(
total_sum = sum(sum_mean, na.rm = TRUE)
)
data$total_sum = sfun_strip_stata_attributes(data$total_sum) 
data = data %>%
  dplyr::mutate(
total_sum = sum(sum_mean, na.rm = TRUE)
)

data$total_sum = sfun_strip_stata_attributes(data$total_sum)

 36 do:  gen proportion = sum_mean/total_sum
 36 r:  data = data %>%
  dplyr::mutate(proportion = sum_mean/total_sum)
data$proportion = sfun_strip_stata_attributes(data$proportion) 
data = data %>%
  dplyr::mutate(proportion = sum_mean/total_sum)

data$proportion = sfun_strip_stata_attributes(data$proportion)

 37 do:  sort proportion
 37 r:  data = dplyr::arrange(data, proportion) 
data = dplyr::arrange(data, proportion)

 38 do:  save "result_data.dta", replace
 38 r:  haven::write_dta(data, path = file.path(stata2r_env$working_dir, "result_data.dta")) # Options ignored: replace 
haven::write_dta(data, path = file.path(stata2r_env$working_dir, "result_data.dta")) # Options ignored: replace


---
Outcome of test 'do2': not ok


Details:

cmd_df = do_parse(do_code)
cmd_df = mark_data_manip_cmd(cmd_df)

str(cmd_df)
'data.frame':	82 obs. of  9 variables:
 $ line              : int  1 2 3 4 5 6 7 8 9 10 ...
 $ do_code           : chr  "use \"test_data.dta\", clear" "generate value1_log = log(value1)" "generate value2_squared = value2^2" "generate int_value1 = int(value1) if !missing(value1)" ...
 $ stata_cmd_original: chr  "use" "generate" "generate" "generate" ...
 $ stata_cmd         : chr  "use" "generate" "generate" "generate" ...
 $ rest_of_cmd       : chr  "\"test_data.dta\", clear" "value1_log = log(value1)" "value2_squared = value2^2" "int_value1 = int(value1) if !missing(value1)" ...
 $ is_by_prefix      : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ by_group_vars     : chr  NA NA NA NA ...
 $ by_sort_vars      : chr  NA NA NA NA ...
 $ do_translate      : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
NULL

---
#Translate Stata to R commands... ... translation done.
---
# Run translated R commands and compare results


 1 do:  use "test_data.dta", clear
 1 r:  data = haven::read_dta(file.path(stata2r_env$working_dir, "test_data.dta")) # 'clear' was used 
data = haven::read_dta(file.path(stata2r_env$working_dir, "test_data.dta")) # 'clear' was used

 2 do:  generate value1_log = log(value1)
 2 r:  data = data %>%
  dplyr::mutate(value1_log = log(value1))
data$value1_log = sfun_strip_stata_attributes(data$value1_log) 
data = data %>%
  dplyr::mutate(value1_log = log(value1))

data$value1_log = sfun_strip_stata_attributes(data$value1_log)

 3 do:  generate value2_squared = value2^2
 3 r:  data = data %>%
  dplyr::mutate(value2_squared = value2^2)
data$value2_squared = sfun_strip_stata_attributes(data$value2_squared) 
data = data %>%
  dplyr::mutate(value2_squared = value2^2)

data$value2_squared = sfun_strip_stata_attributes(data$value2_squared)

 4 do:  generate int_value1 = int(value1) if !missing(value1)
 4 r:  data = data %>%
  dplyr::mutate(int_value1 = dplyr::if_else(!is.na(value1), trunc(value1), NA_real_))
data$int_value1 = sfun_strip_stata_attributes(data$int_value1) 
data = data %>%
  dplyr::mutate(int_value1 = dplyr::if_else(!is.na(value1), trunc(value1), NA_real_))

data$int_value1 = sfun_strip_stata_attributes(data$int_value1)

 5 do:  generate rounded_value1 = round(value1, 0.1) if !missing(value1)
 5 r:  data = data %>%
  dplyr::mutate(rounded_value1 = dplyr::if_else(!is.na(value1), sfun_stata_round(value1,  0.1), NA_real_))
data$rounded_value1 = sfun_strip_stata_attributes(data$rounded_value1) 
data = data %>%
  dplyr::mutate(rounded_value1 = dplyr::if_else(!is.na(value1), sfun_stata_round(value1,  0.1), NA_real_))

data$rounded_value1 = sfun_strip_stata_attributes(data$rounded_value1)

 6 do:  generate random_uniform_draw = runiform()
 6 r:  data = data %>%
  dplyr::mutate(random_uniform_draw = stats::runif(as.numeric(dplyr::n())))
data$random_uniform_draw = sfun_strip_stata_attributes(data$random_uniform_draw) 
data = data %>%
  dplyr::mutate(random_uniform_draw = stats::runif(as.numeric(dplyr::n())))

data$random_uniform_draw = sfun_strip_stata_attributes(data$random_uniform_draw)

 7 do:  generate id_plus_value2 = id + value2 if value2 < 7 & !missing(value2)
 7 r:  data = data %>%
  dplyr::mutate(id_plus_value2 = dplyr::if_else(value2 < 7 & !is.na(value2), id + value2, NA_real_))
data$id_plus_value2 = sfun_strip_stata_attributes(data$id_plus_value2) 
data = data %>%
  dplyr::mutate(id_plus_value2 = dplyr::if_else(value2 < 7 & !is.na(value2), id + value2, NA_real_))

data$id_plus_value2 = sfun_strip_stata_attributes(data$id_plus_value2)

 8 do:  replace value1_log = 0 if missing(value1_log) & !missing(value1)
 8 r:  data = data %>%
  dplyr::mutate(value1_log = dplyr::if_else(is.na(value1_log) & !is.na(value1), 0, data$value1_log))
data$value1_log = sfun_strip_stata_attributes(data$value1_log) 
data = data %>%
  dplyr::mutate(value1_log = dplyr::if_else(is.na(value1_log) & !is.na(value1), 0, data$value1_log))

data$value1_log = sfun_strip_stata_attributes(data$value1_log)

 9 do:  replace value1 = value1 * 1.5 if group_orig == "Alpha" & !missing(value1) & !missing(group_orig)
 9 r:  data = data %>%
  dplyr::mutate(value1 = dplyr::if_else(group_orig == "Alpha" & !is.na(value1) & !is.na(group_orig), value1 * 1.5, data$value1))
data$value1 = sfun_strip_stata_attributes(data$value1) 
data = data %>%
  dplyr::mutate(value1 = dplyr::if_else(group_orig == "Alpha" & !is.na(value1) & !is.na(group_orig), value1 * 1.5, data$value1))

data$value1 = sfun_strip_stata_attributes(data$value1)

 10 do:  gen group_clean = strtrim(stritrim(lower(group_orig)))
 10 r:  data = data %>%
  dplyr::mutate(group_clean = stringi::stri_trim_both(stringi::stri_replace_all_regex(stringi::stri_trim_both(stringi::stri_trans_tolower(group_orig), "\\s+", " "))))
data$group_clean = sfun_strip_stata_attributes(data$group_clean) 
data = data %>%
  dplyr::mutate(group_clean = stringi::stri_trim_both(stringi::stri_replace_all_regex(stringi::stri_trim_both(stringi::stri_trans_tolower(group_orig), "\\s+", " "))))

Error: Problem with `mutate()` column `group_clean`.
ℹ `group_clean = stringi::stri_trim_both(...)`.
✖ missing values in argument `negate` is not supported
Caused by error in `stringi::stri_trim_both()`:
! missing values in argument `negate` is not supported
data$group_clean = sfun_strip_stata_attributes(data$group_clean)

Warning: Unknown or uninitialised column: `group_clean`.
Error executing R code for Stata line  10 :  data = data %>%
  dplyr::mutate(group_clean = stringi::stri_trim_both(stringi::stri_replace_all_regex(stringi::stri_trim_both(stringi::stri_trans_tolower(group_orig), "\\s+", " "))))

Error: Problem with `mutate()` column `group_clean`.
ℹ `group_clean = stringi::stri_trim_both(...)`.
✖ missing values in argument `negate` is not supported
Caused by error in `stringi::stri_trim_both()`:
! missing values in argument `negate` is not supported
data$group_clean = sfun_strip_stata_attributes(data$group_clean)

Warning: Unknown or uninitialised column: `group_clean`. 
