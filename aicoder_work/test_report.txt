In total 1 of 2 tests failed.


---
Outcome of test 'source_r': ok
All R files could be sourced.



---
Outcome of test 'do1': not ok


Details:

cmd_df = do_parse(do_code)
cmd_df = mark_data_manip_cmd(cmd_df)

str(cmd_df)
'data.frame':	39 obs. of  9 variables:
 $ line              : int  1 2 3 4 5 6 7 8 9 10 ...
 $ do_code           : chr  "use \"data.dta\", clear" "sort group i" "by group: gen seq = _n" "gen logi = log(i)" ...
 $ stata_cmd_original: chr  "use" "sort" "gen" "gen" ...
 $ stata_cmd         : chr  "use" "sort" "gen" "gen" ...
 $ rest_of_cmd       : chr  "\"data.dta\", clear" "group i" "seq = _n" "logi = log(i)" ...
 $ is_by_prefix      : logi  FALSE FALSE TRUE FALSE FALSE FALSE ...
 $ by_group_vars     : chr  NA NA "group" NA ...
 $ by_sort_vars      : chr  NA NA NA NA ...
 $ do_translate      : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
NULL

---
#Translate to R commands

do:  use "data.dta", clear 
R:  data = haven::read_dta("data.dta") # 'clear' was used 

do:  sort group i 
R:  data = dplyr::arrange(data, group, i) 

do:  by group: gen seq = _n 
R:  data = data %>%
  dplyr::group_by(dplyr::across(c("group"))) %>%
  dplyr::mutate(seq = collapse::fseq()) %>%
  dplyr::ungroup() 

do:  gen logi = log(i) 
R:  data = data %>%
  dplyr::mutate(logi = log(i)) 

do:  gen sqrt_i = sqrt(i) 
R:  data = data %>%
  dplyr::mutate(sqrt_i = sqrt(i)) 

do:  gen group_num = cond(group=="A",1,cond(group=="B",2,3)) 
R:  data = data %>%
  dplyr::mutate(group_num = dplyr::if_else(group=="A", 1, dplyr::if_else(group=="B", 2, 3))) 

do:  egen mean_i_grp = mean(i), by(group) 
Error : 'stri_stri_split_fixed' is not an exported object from 'namespace:stringi'

